<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport"
        content="width=device-width, initial-scale=0.8, maximum-scale=0.8, minimum-scale=0.8, user-scalable=no, minimal-ui">
    <link rel="stylesheet" href="css/historico.css">
    <title>HISTORICO</title>
    <style>
        #tela_transacoes {
            display: contents;
            border: 1px solid red;

        }

        .transacoes_item {
            margin: 15px;

        }

        .saque {
            border-left: 5px solid green;
            text-align: left;
        }
       

        .deposito {
            border-right: 5px solid yellowgreen;           
            text-align: right;
        }

        .img_btn {
            width: 30px;
        }
    </style>

</head>

<body style="display: none;">
    <div class="main fadeInDown">
        <div id="formContent">
            <a href="../financeiro/index.html">FINANCEIRO</a>
            <div class="cx_group_btn">
                <button class="botao_tab btn_ativo" onclick="reset()">
                    TRANSACOES
                    <hr>
                    <img src="../historico/transacoes.png" alt="transacoes" class="img_btn">
                </button>
                <button class="botao_tab" onclick="filter('deposito')">
                    DEPOSITOS
                    <hr>
                    <img src="../historico/deposito.png" alt="depositos" class="img_btn">
                </button>
                <button class="botao_tab" onclick="filter('saque')">
                    SAQUES
                    <hr>
                    <img src="../historico/saques.png" alt="saques" class="img_btn">
                </button>
            </div>
            <div id="tela_transacoes"></div>
        </div>
    </div>
    <script src="js/jquery.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="js/mascara.js"></script>

    <script src="https://unpkg.com/@lottiefiles/lottie-player@0.4.0/dist/lottie-player.js"></script>

    <script>

        let user = localStorage.getItem('@JETPIX_USERDATA')
        let token = localStorage.getItem('@JETPIX_TOKEN')
        let limit_saque = 0;
        let URL = 'https://api-homolog.jetpix.bet/';

        jQuery(document).ready(function ($) {
            initializeMasks();
            verifySessao()
            dataTransacao();
        });


        function dataTransacao() {
            axios({
                method: 'get',
                url: URL + 'transactions/mime',
                headers: { auth: token }
            }).then(function (response) {
                montarTelaTransacao(response);
            }).catch(function (error) {
                if (error.response.status == 401) {
                    finalizarSessao()
                }
                console.log(error.response)
            });
        }
        function montarTelaTransacao(response) {
            let corpo = "";
            let indice = response.data;
            if (indice != null) {

                for (let i = 0; i < indice.length; i++) {
                    let tipo = indice[i].type;
                    let amount = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(indice[i].amount)
                    if (tipo == 1) {
                        corpo += `<div class='deposito transacoes_item'>Deposito: ${amount}</div>`
                    } else {
                        corpo += `<div class='saque transacoes_item'>Saque: ${amount}</div>`
                    }
                }

            } else {
                corpo = `ERRO NO JSON`
            }
            console.log(response.data)

            $("#tela_transacoes").html(corpo)
        }



        function finalizarSessao() {

            localStorage.removeItem('@JETPIX_USERDATA')
            localStorage.removeItem('@JETPIX_TOKEN')
            window.location.assign('../index.html')
        }
        function verifySessao() {

            if (localStorage.getItem("@JETPIX_TOKEN") === null) {
                finalizarSessao()
            } else {
                $("body").show()
            }

        }

        // function dadosUsuario() {
        //     let user = localStorage.getItem('@JETPIX_USERDATA')
        //     let dados = JSON.parse(user);
        //     let balance = dados.balance;
        //     let format_balance = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(balance)
        //     $(".saldo").html(format_balance)
        //     $("#amountsaque").attr('placeholder', 'Valor m√°ximo: ' + format_balance)
        // }


        $(".botao_tab").on('click', function (e) {
            $(".botao_tab").removeClass('btn_ativo')
            $(this).addClass('btn_ativo')
        })

        function initializeMasks() {

            $(".mask-cpf").mask("999.999.999-99");
            $('.money').mask("#.##0,00", { reverse: true }).attr('maxlength', '9');
            $(".mask-phone").mask("(99) 99999-9999");
            $(".mask-dinheiro")
                .mask("######.##", {
                    reverse: true
                }).attr('maxlength', '9');
        }



        // const VALIDAR = {


        // }

        function filter(el) {
            var item = document.getElementsByClassName('transacoes_item');

            for (var i = 0; i < item.length; i++) {
                if (item[i].classList.contains(el)) {
                    item[i].style.display = "block";
                }
                else {
                    item[i].style.display = "none";
                }
            }

        };

        function reset() {
            var item = document.getElementsByClassName('transacoes_item');

            for (var i = 0; i < item.length; i++) {
                item[i].style.display = "block";
            }
        };

    </script>
</body>

</html>